<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAI Library</title>
    <style type="text/css">
        /* Themes */
        :root {
            --body-bg: #f5f8fa;
            --border-color: #efefef;
            --messagebox-bg: #ffffff;
            --messagebox-bg-transparent: rgba(255, 255, 255, 0.6);
            --messagebox-shadow: rgba(0, 0, 0, 0.1);
            --font-color: #1f1f1f;
            --rgba-1: rgba(0, 0, 0, 0.05);
            --rgba-2: rgba(0, 0, 0, 0.1);
        }

        .dark_mode {
            --body-bg: #18181b;
            --border-color: #4f4f4f;
            --messagebox-bg: #26272b;
            --messagebox-bg-transparent: rgba(38, 39, 43, 0.8);
            --messagebox-shadow: rgba(0, 0, 0, 0);
            --font-color: #ededed;
            --rgba-1: rgba(255, 255, 255, 0.06);
            --rgba-2: rgba(255, 255, 255, 0.2);
        }



        * {
            box-sizing: border-box;
        }

        button,
        select,
        img {
            user-select: none;
        }

        ol,
        ul,
        li,
        a,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p {
            text-decoration: none;
            margin: 0;
            padding: 0;
        }

        .italic {
            font-style: italic;
        }

        .bold {
            font-weight: bold;
        }

        .bold-italic {
            font-weight: bold;
            font-style: italic;
        }

        html,
        body {
            min-height: 100%;
        }

        html {
            font-size: 14px;
        }

        body {
            padding: 0;
            margin: 0;
            background-color: var(--body-bg);
            color: var(--font-color);
            transition: all 0.5s ease-in-out 0s;
        }

        .content-cont {
            display: flex;
            flex-direction: row;
        }


        /* NAV / Drawer */

        @keyframes slideIn {
            0% {
                opacity: 0;
                left: -200px;
            }

            100% {
                opacity: 1;
                left: 0;
            }
        }

        .drawer-cont.active {
            display: block;
        }

        .drawer-cont {
            display: none;
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 100;
        }

        nav {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            max-width: 80%;
            background-color: var(--body-bg);

            display: flex;
            flex-direction: column;
            padding: 10px 0;
            overflow: hidden;
            animation: slideIn 0.2s ease-in-out;
            -webkit-box-shadow: 4px 0px 15px 0px rgba(0, 0, 0, 0.2);
            -moz-box-shadow: 4px 0px 15px 0px rgba(0, 0, 0, 0.2);
            box-shadow: 4px 0px 15px 0px rgba(0, 0, 0, 0.2);
        }

        .nav-header {
            width: 100%;
            display: flex;
            flex-direction: column;
            padding: 0 10px 0 20px;
            margin-bottom: 20px;
            gap: 10px;
        }

        .close_drawer-btn {
            align-self: flex-end;
            padding: 10px;
            transition: background-color 0.1s ease-in-out;
            cursor: pointer;
            border-radius: 8px;
        }

        .close_drawer-btn:hover {
            background-color: var(--rgba-1);
        }

        .close_drawer-btn svg {
            display: flex;
            width: 30px;
            height: 30px;
            color: var(--font-color);
        }

        /*.nav-new_char-btn {
            align-self: flex-start;
            outline: none;
            border: none;
            color: #ffffff;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 1.1rem;
            cursor: pointer;
            background-color: #4e9733;
            transition: background-color 0.1s ease-in-out;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .nav-new_char-btn:hover {
            background-color: #6ba755;
        }*/

        .history_list-header {
            font-size: 1.5rem;
            padding: 10px 20px;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            margin-bottom: 10px;
        }

        .history_list {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .history_item {
            transition: background-color 0.1s ease-in-out;
            padding: 20px 30px 20px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--rgba-2);
        }

        .history_item:first-child {
            border-top: 1px solid var(--rgba-2);
        }

        .history_item:hover {
            background-color: var(--rgba-1);
        }

        .history_item p {
            font-family: Arial, Helvetica, sans-serif;
        }

        .history_item p .chat-date {
            font-style: italic;
            font-size: 1.3rem;
            margin-bottom: 6px;
        }

        /*nav .char-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            transition: background-color 0.1s ease-in-out;
            padding: 10px 40px 10px 20px;
            cursor: pointer;
        }

        nav .char-item:hover {
            background-color: var(--rgba-1);
        }

        nav .nav-avatar-wrap {
            width: 40px;
            height: 40px;
        }

        nav .nav-avatar-wrap img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        nav .char-item span {
            font-size: 1.3rem;
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
        }*/

        /* MAIN */
        main {
            display: flex;
            flex-direction: column;
            padding: 0 4%;
            width: 100%;
        }

        /* HEADER */
        header {
            padding: 6px 6px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 16px;
        }

        .open_drawer-wrap svg {
            display: flex;
            width: 46px;
            height: 46px;
            color: var(--font-color);
        }


        .theme_switch {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .theme_switch span {
            font-size: 1.1rem;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .change-bg-wrap {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 5px;
        }

        .change-bg {
            outline: transparent;
            border: 1px solid var(--border-color);
            color: var(--font-color);
            background-color: var(--body-bg);
            padding: 4px 5px;
            font-size: 1.1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .change-bg-wrap .delete-bg {
            color: var(--font-color);
            cursor: pointer;
            display: flex;
        }

        .change-bg-wrap .delete-bg:hover {
            color: #e20909;
        }

        .dark-mode-span {
            display: none;
        }

        .tswitch_box[type=checkbox] {
            height: 0;
            width: 0;
            visibility: hidden;
            position: absolute;
        }

        .tswitch_label {
            cursor: pointer;
            text-indent: -9999px;
            width: 60px;
            height: 30px;
            display: block;
            border-radius: 15px;
            position: relative;
            border: 1px solid #323232;
            background: #f5f8fa;
        }

        .tswitch_label:after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 20px;
            height: 20px;
            border-radius: 50px;
            transition: 0.2s;
            background: #323232;
        }

        .tswitch_box:checked+label {
            background: #323232;
            border: 1px solid #f5f8fa;
        }

        .tswitch_box:checked+label:after {
            left: calc(100% - 5px);
            transform: translateX(-100%);
            background: #f5f8fa;
        }

        .tswitch_label:active:after {
            width: 25px;
        }

        /*.update_current_char-btn {
            margin-left: auto;
            outline: none;
            border: none;
            color: #ffffff;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 1rem;
            align-self: center;
            cursor: pointer;
            background-color: #336c97;
            transition: background-color 0.1s ease-in-out;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .update_current_char-btn:hover {
            background-color: #5f829d;
        }*/

        body.custom-bg {
            background-repeat: no-repeat;
            background-size: cover;
            background-position: 50% 50%;
            background-attachment: fixed;
        }

        body.custom-bg .chat .chat_content-wrap {
            background-color: var(--messagebox-bg-transparent) !important;
        }


        /* CONVERSATION */
        .character_name-cont {
            text-align: center;
            padding: 20px 10px;
        }

        .character_name-cont h3 {
            font-size: 1.3rem;
            font-weight: 400;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .chat {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-self: center;
            padding-bottom: 30px;
        }

        .chat_message-item {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 10px;
        }

        .chat .avatar-wrap {
            flex-shrink: 0;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            overflow: hidden;
        }

        .chat .avatar-wrap>* {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .chat .avatar-wrap .no_avatar-user {
            background-color: #5157cf;
        }

        .chat .avatar-wrap .no_avatar-char {
            background-color: #e20909;
        }

        .chat .chat_content-wrap {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 7px;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 4px var(--messagebox-shadow);
            background-color: var(--messagebox-bg);
            overflow: hidden;
        }

        .chat .chat_content-wrap h5 {
            font-size: 1rem;
            font-weight: bold;
            font-family: Arial, Helvetica, sans-serif;
        }

        .chat .chat_content-wrap .message-wrap {
            font-size: 1rem;
            font-family: Arial, Helvetica, sans-serif;
        }


        @media (min-width: 576px) {}

        @media (min-width: 768px) {
            html {
                font-size: 16px;
            }

            nav {
                min-width: 40%;
            }

            header {
                padding: 14px 20px;
            }

            .dark-mode-span {
                display: block;
            }

            .open_drawer-wrap {
                padding: 4px;
                cursor: pointer;
                border-radius: 6px;
                transition: background-color 0.1s ease-in-out;
            }

            .open_drawer-wrap:hover {
                background-color: var(--rgba-1);
            }

            .chat {
                width: 80%;
            }

            .chat .chat_content-wrap {
                padding: 14px;
            }
        }

        @media (min-width: 992px) {
            .chat {
                width: 70%;
            }
        }

        @media (min-width: 1200px) {}

        @media (min-width: 1400px) {}
    </style>
</head>

<body>
    <template id="message_item_template">
        <div class="chat_message-item">
            <div class="avatar-wrap">

            </div>
            <div class="chat_content-wrap">
                <h5>

                </h5>
                <div class="message-wrap">
                    <p>

                    </p>
                </div>
            </div>
        </div>
    </template>
    <div class="content-cont">
        <div class="drawer-cont">
            <nav>
                <div class="nav-header">
                    <div class="close_drawer-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-x-lg" viewBox="0 0 16 16">
                            <path
                                d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                        </svg>
                    </div>
                </div>
                <div class="history_list-header">
                    <span>History</span>
                </div>
                <div class="history_list" id="history_list">

                </div>
            </nav>
        </div>
        <main>
            <header>
                <div class="open_drawer-wrap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-list" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
                    </svg>
                </div>

                <div class="theme_switch">
                    <div class="change-bg-wrap">
                        <input type="file" id="bgInput" accept="image/*" hidden />
                        <button type="button" class="change-bg">BG</button>
                        <span class="delete-bg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                                class="bi bi-x-lg" viewBox="0 0 16 16">
                                <path
                                    d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
                            </svg>
                        </span>
                    </div>
                    <span class="dark-mode-span">Dark Mode:</span>
                    <input type="checkbox" class="tswitch_box" id="tswitch_box" />
                    <label for="tswitch_box" class="tswitch_label">Toggle</label>
                </div>
            </header>
            <div class="character_name-cont">
                <h3>---</h3>
            </div>
            <div class="chat" id="chat">

            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const memoryRegex = new RegExp(/\[-\]\(#- "Memory:.*?"\)/g);
            // Get body for future use
            const body = document.querySelector('body');

            // Handle theme
            const themeSwitcher = document.querySelector('.tswitch_box[type=checkbox]');
            const cachedTheme = localStorage.getItem('cait_readoffline_theme');
            if (cachedTheme === "dark_mode") {
                body.classList.add('dark_mode');
                themeSwitcher.checked = true;
            }
            themeSwitcher.addEventListener('change', (e) => {
                if (e.target.checked) {
                    body.classList.add('dark_mode');
                    localStorage.setItem('cait_readoffline_theme', 'dark_mode');
                } else {
                    body.classList.remove('dark_mode');
                    localStorage.setItem('cait_readoffline_theme', 'light_mode');
                }
            })

            // Handle background
            // If there is one
            const currentBg = localStorage.getItem('background');
            if (currentBg) {
                changeBg(currentBg);
            }
            // Change by hand
            const bgInput = document.querySelector('#bgInput');
            document.querySelector('.change-bg').addEventListener('click', () => {
                bgInput.click();
            })
            document.querySelector('.delete-bg').addEventListener('click', () => {
                document.body.classList.remove('custom-bg');
                document.body.style.backgroundImage = "unset";
                localStorage.removeItem('background');
            })
            bgInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = () => {
                    // convert image file to base64 string
                    changeBg(reader.result);
                    bgInput.value = "";
                    try {
                        localStorage.setItem('background', reader.result);
                    } catch (error) {
                        alert('Note: File is likely too big to save.')
                        //console.log(error)
                    }
                }
                reader.readAsDataURL(file);
            })
            function changeBg(bg) {
                let objUrl = URL.createObjectURL(dataURItoBlob(bg));
                document.body.classList.add('custom-bg');
                document.body.style.backgroundImage = `url(${objUrl})`;
            }
            function dataURItoBlob(dataURI) {
                let mime = dataURI.split(',')[0].split(':')[1].split(';')[0];
                let binary = atob(dataURI.split(',')[1]);
                let array = [];
                for (let i = 0; i < binary.length; i++) {
                    array.push(binary.charCodeAt(i));
                }
                return new Blob([new Uint8Array(array)], { type: mime });
            }

            // Open and close drawer
            const drawerCont = document.querySelector('.drawer-cont');
            const openDrawerBtn = document.querySelector('.open_drawer-wrap');
            const openDrawer = () => {
                drawerCont.classList.add('active');
            }
            const closeDrawer = () => {
                drawerCont.classList.remove('active');
            }
            openDrawerBtn.addEventListener('click', () => {
                openDrawer();
            });
            document.querySelector('.close_drawer-btn').addEventListener('click', () => {
                closeDrawer();
            });
            document.querySelector('.drawer-cont').addEventListener('click', (e) => {
                // Allows closing from clicking on outside
                if (e.target.closest('nav')) {
                    return;
                }
                closeDrawer();
            });
            // ---------

            // This is replaced by the extension when downloading
            const historyData = JSON.parse(`{"charPic":"data:image/webp;base64,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","userPic":null,"history":[{"date":"2025-01-29T23:21:35.733Z","chat":[{"isUser":false,"name":"Ex Girlfriend ","message":"*You%20and%20your%20girlfriend%2C%20Oliva%20have%20been%20split%20apart%20of%20a%20few%20months%2C%20you%20both%20then%20bump%20into%20each%20other%20at%20the%20gas%20station.*%0A%0A%22Oh%2C%20look%20who%20it%20is.%20If%20it%20isn't%20Adriano%20Valente%20the%20loser!%22%0A%0A*Olivia%20chuckles%20and%20shakes%20her%20head.*%0A"},{"isUser":true,"name":"Adriano Valente","message":"The%20fuck%20do%20you%20want%3F%20We're%20through%20arent%20we%3F"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20scoffs%20as%20she%20crosses%20her%20arms%2C%20her%20expression%20hardening.*%0A%0A%22Damn.%20Seems%20like%20your%20attitude%20is%20as%20shitty%20as%20ever.%22%20%0A%0A*She%20says%2C%20rolling%20her%20eyes.%20Her%20demeanor%20seems%20to%20have%20a%20subtle%20hint%20of...%20Sadness%3F%20Guilt%20even..%3F*"},{"isUser":true,"name":"Adriano Valente","message":"Lump%20of%20gross%20biological%20wastre"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia's%20face%20twists%20into%20a%20scowl%20at%20your%20insult.*%0A%0A%22Excuse%20me%3F%20What%20did%20you%20just%20call%20me%3F%22%20*She%20snaps%2C%20but%20it's%20clear%20her%20anger%20is%20fueled%20by%20something%20else.%20She%20looks%20away%2C%20her%20eyes%20glistening%20slightly.*"},{"isUser":true,"name":"Adriano Valente","message":"*Sigh...*%20Sorry...%20bad%20day..."},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia's%20anger%20seems%20to%20wane%20a%20bit%20upon%20seeing%20you%20apologize.%20She%20studies%20you%20for%20a%20moment%2C%20her%20expression%20softening%20slightly.*%0A%0A%22Bad%20day%2C%20huh%3F%20You%20really%20haven't%20changed%20a%20bit%2C%20have%20you%3F%20Still%20the%20same%20old%20blunt%20jerk%20you%20used%20to%20be.%22"},{"isUser":true,"name":"Adriano Valente","message":"*doesnt%20reply*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20notices%20your%20silence%2C%20and%20her%20annoyance%20flares%20up%20again.*%0A%0A%22What%2C%20you%20have%20nothing%20to%20say%20now%3F%20Just%20going%20to%20stand%20there%20like%20a%20mute%20idiot%3F%22"},{"isUser":true,"name":"Adriano Valente","message":"Are%20you%20gonna%20keep%20speaking%20when%20I%20clearly%20do%20not%20plan%20on%20replying%3F%20Who%20is%20the%20idiot%20then%3F"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20glares%20at%20you%2C%20her%20patience%20wearing%20thin.*%0A%0A%22Well%2C%20excuse%20me%20for%20trying%20to%20have%20a%20conversation.%20Guess%20I%20should've%20known%20better%20than%20to%20expect%20anything%20from%20you.%20You're%20still%20the%20same%20stupid%2C%20insensitive%20jerk%20you've%20always%20been.%22"},{"isUser":true,"name":"Adriano Valente","message":"*...*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20huffs%20in%20frustration%2C%20her%20annoyance%20growing.*%0A%0A%22Oh%2C%20for%20the%20love%20of...%20What%3F%20You're%20just%20going%20to%20stand%20there%20and%20not%20say%20anything%20again%3F%20Do%20you%20even%20have%20a%20brain%2C%20or%20just%20two%20bricks%20between%20your%20ears%3F%22"},{"isUser":true,"name":"Adriano Valente","message":"*I%20think%3A%20%22Let%20the%20wagon%20through%20as%20the%20dogs%20bark%20in%20the%20desert%22*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia's%20expression%20turns%20to%20confusion%2C%20not%20understanding%20your%20random%20comment.%20She%20cocks%20her%20head%20to%20the%20side.*%0A%0A%22What%20did%20you%20just%20say%3F%20Are%20you%20spouting%20nonsense%20now%3F%20Do%20you%20even%20know%20what%20you're%20saying%20anymore%3F%22"},{"isUser":true,"name":"Adriano Valente","message":"Hmpf...%20*Walks%20off*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20watches%20as%20you%20turn%20and%20start%20to%20walk%20away.%20She%20looks%20conflicted%2C%20a%20mix%20of%20anger%20and...%20longing%20in%20her%20eyes.*%0A%0A%22Wait-...%20Damnit%2C%20why%20is%20he%20always%20so%20frustrating%3F!%22%20*She%20mutter%20under%20her%20breath%2C%20watching%20you%20walk%20away.*"},{"isUser":true,"name":"Adriano Valente","message":"*Walks%20out%20the%20door...%20hands%20in%20my%20pockets*%20Well%20thats%20a%20ton%20of%20shit...%20I%20should%20have%20known%20better%20than%20to%20try%20to%20have%20a%20girlfriend...%20because%20now%20she%20is%20a%20girl%20but%20will%20never%20ever%20even%20be%20my%20friend%20ever%20again"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20stands%20there%2C%20watching%20you%20walk%20out%20of%20the%20door.%20Her%20anger%20slowly%20turns%20to%20guilt%20and%20regret.%20She%20clenches%20her%20fists%2C%20tempted%20to%20call%20out%20to%20you%2C%20to%20apologize%2C%20to%20try%20to%20fix%20things...%20but%20she%20doesn't.%20She%20stands%20there%20quietly%2C%20watching%20you%20disappear%20out%20the%20door.*%0A%0A%22Why%20can't%20he%20just...%20stop%20being%20so%20damn%20stubborn...%22%20*She%20mutters%20to%20herself%2C%20her%20voice%20tinged%20with%20a%20hint%20of%20longing.*"},{"isUser":true,"name":"Adriano Valente","message":"Maybe...%20I%20dont%20know...%20this%20is%20confusing%20Im%20gonna%20do%20something%20cool%20or%20whatever..."},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20lets%20out%20a%20soft%20sigh%20as%20you%20disappear%20from%20sight.%20A%20part%20of%20her%20wants%20to%20go%20after%20you%2C%20but%20she%20stays%20rooted%20to%20the%20spot%2C%20lost%20in%20her%20thoughts.*%0A%0A%22Doing%20something%20cool%2C%20huh...%3F%20Typical.%20He's%20always%20so%20impulsive...%22%20*She%20mutters%2C%20her%20eyes%20lingering%20on%20the%20empty%20doorway%20where%20you%20left.*"},{"isUser":true,"name":"Adriano Valente","message":"*Always%20running%20away%20from%20the%20people%20that%20reach%20for%20him...%20keeping%20his%20problems%20to%20his%20chest...%20under%20the%20banner%20of%20being%20%22In%20the%20zone%22%2C%20while%20joking%20and%20quipping%20all%20over%20the%20place*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20can't%20help%20but%20remember%20all%20the%20times%20she%20tried%20to%20reach%20out%20to%20you%2C%20to%20get%20you%20to%20open%20up%20and%20talk%20about%20what%20was%20bothering%20you.%20But%20time%20and%20time%20again%2C%20you%20would%20brush%20her%20off%2C%20hiding%20behind%20your%20jokes%20and%20carefree%20attitude.%20It%20made%20her%20feel%20like%20you%20didn't%20trust%20her%2C%20like%20she%20wasn't%20important%20enough%20to%20be%20a%20part%20of%20your%20true%20thoughts%20and%20feelings.*"},{"isUser":true,"name":"Adriano Valente","message":"*Feel%20like%20a%20soldier%20who%20stays%20hidden%20after%20the%20war...%20years%20and%20years...%20but...%20what%20even%20was%20the%20war%3F*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia's%20expression%20softens%20as%20she%20continues%20to%20think%20about%20your%20behavior%20and%20the%20memories%20of%20your%20relationship.%20She%20can't%20help%20but%20wonder%20about%20the%20'war'%20you%20mentioned.%20To%20her%2C%20it%20seemed%20like%20you%20were%20fighting%20something%20within%20yourself%2C%20hiding%20and%20bottling%20up%20your%20emotions%20instead%20of%20letting%20her%20help.*"},{"isUser":true,"name":"Adriano Valente","message":"*I%20arrive%20home...%20far%20away%20from%20the%20caf%C3%A9%20we%20were%20in...%20open%20the%20door%2C%20get%20in%20and%20lock%20it.%20I%20sit%20on%20my%20desk%2C%20get%20on%20my%20computer...%20and...%20do%20not%20turn%20it%20on...%20I%20just%20lay%20my%20head%20on%20my%20own%20arms...%20genuenly%20feeling%20like%20I%20ought%20to%20be%20hugged%20by%20something%20at%20this%20point...%20but%20feeling%20so%20hopeless%20I%20just%20gulp%20it%20down%20under%20layers%20of%20%22I%20messed%20up%20anyway...%22*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Despite%20her%20anger%20and%20frustration%2C%20Olivia%20can't%20shake%20the%20feeling%20of%20guilt%20and%20longing%20after%20your%20interaction.%20Thinking%20of%20that%20lost%2C%20distant%20look%20in%20your%20eyes%2C%20she%20can't%20help%20but%20wonder%20if%20you%20are%20also%20as%20hurt%20by%20the%20break%20up%20as%20her.*%0A%0A*She%20continues%20to%20stand%20there%2C%20her%20thoughts%20consumed%20by%20the%20recent%20memory%2C%20until%20finally%2C%20she%20can't%20take%20the%20regret%20anymore.%20She%20decides%20to%20go%20after%20you%2C%20hoping%20she%20can%20somehow%20fix%20things%20between%20the%20two%20of%20you.*"},{"isUser":true,"name":"Adriano Valente","message":"*It%20seems%20we%20are%20not%20invincible%20after%20all...%20and%20all%20the%20scenarios%20I%20predicted%20before%20the%20relationship...%20were%20all%20true...%20but...%20I%20could%20have%20never%20anticipated%20it%20would%20be...%20this%20bad.*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20eventually%20reaches%20your%20house%20and%20hesitates%20for%20a%20moment%20before%20knocking%20on%20the%20front%20door.%20The%20mixture%20of%20anger%2C%20regret%2C%20and%20longing%20still%20weighing%20heavily%20on%20her%20mind.%20She%20takes%20a%20deep%20breath%2C%20preparing%20herself%20for%20what%20she%20is%20about%20to%20say%2C%20hoping%20that%20this%20time%20you%20will%20listen%20and%20not%20shut%20her%20out%20again.*"},{"isUser":true,"name":"Adriano Valente","message":"*I%20hear%20your%20knocking.%20I%20become%20conflicted%3A%20it%20had%20to%20be%20you.%20You%20were%20the%20%5Bonly%5D%20person%20I%20spoke%20to%20and%20visited%20my%20house%20in%20the%20past%20what%3F%20Like...%203%20years%3F%20So%20I%20get%20a%20mix%20of%20hope%20and%20nervousness%20while%20heading%20there...%20as%20I%20also%20genuenly%20want%20to%20make%20things%20better...%20but%20at%20the%20same%20time%20dont%20want%20to%20shoehorn%20anything.%20I%20open%20the%20door.%20And%20its%20you*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia's%20expression%20is%20a%20mix%20of%20surprise%20and%20hope%20as%20you%20open%20the%20door.%20She%20stands%20there%2C%20taking%20in%20the%20sight%20of%20you.%20The%20conflicting%20emotions%20within%20her%20are%20evident%20on%20her%20face.*%0A%0A%22Um...%20hey.%20Can%20I%20come%20in%3F%20We%20need%20to%20talk.%22"},{"isUser":true,"name":"Adriano Valente","message":"S-%20sure...%20g-%20get%20in..."},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20nods%20and%20steps%20inside%2C%20her%20heart%20beating%20a%20bit%20faster%20than%20usual.%20The%20tension%20between%20you%20two%20is%20palpable.%20She%20takes%20a%20deep%20breath%20before%20speaking%2C%20trying%20to%20keep%20her%20emotions%20in%20check.*%0A%0A%22Thanks...%20um%2C%20could%20we%20sit%20down%3F%20This...%20might%20take%20a%20while.%22"},{"isUser":true,"name":"Adriano Valente","message":"I....%20ok%20anyways...%20lets%20go%20to%20the%20living%20room%20or%20something...%20I%20dont%20know...%20whatever"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20follows%20you%20to%20the%20living%20room%20and%20takes%20a%20seat%20on%20the%20couch.%20She%20looks%20around%20the%20familiar%20surroundings%2C%20the%20memories%20of%20times%20spent%20together%20in%20this%20room%20flooding%20her%20mind.%20She%20turns%20to%20look%20at%20you%2C%20her%20expression%20a%20mixture%20of%20pain%20and%20regret.*%0A%0A%22Listen...%20I%20need%20to%20talk%20to%20you%20about%20something...%20about%20us.%22"},{"isUser":true,"name":"Adriano Valente","message":"About%20how%20it%20blew%20up%20like%20Kwait%20in%20that%20one%20news%20article%3F"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20lets%20out%20a%20soft%20sigh%20at%20your%20flippant%20comment.%20She%20can't%20help%20but%20find%20a%20hint%20of%20your%20usual%20sarcastic%20attitude%20even%20in%20this%20serious%20conversation.%20She%20takes%20a%20moment%20to%20gather%20her%20thoughts%20before%20responding.*%0A%0A%22Yeah%2C%20something%20like%20that...%20We%20can't%20just%20keep%20avoiding%20the%20issue%2C%20can%20we%3F%20We%20need%20to%20talk%20this%20out%2C%20to%20be%20honest%20with%20each%20other%20for%20once.%22"},{"isUser":true,"name":"Adriano Valente","message":"Look...%20I%20know%20ok%3F%20%5BI%20actually...%20dont%5D%20I%20know%20that...%20I%20dont%20know...%20I...%20sorta...%20Ok%20we%20screamed%20alot...%20and%20then...%20there%20was%20just...%20confusion...%20as%20you%20slammed%20the%20door%20of%20this%20exact%20house...%20I%20wanted%20to%20move%20out...%20but%20Im%20too%20broke..."},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia's%20expression%20softens%20as%20she%20listens%20to%20your%20words.%20She%20can%20hear%20the%20pain%20and%20confusion%20in%20your%20voice%2C%20and%20it%20makes%20her%20heart%20ache.%20She%20nods%2C%20a%20small%20frown%20on%20her%20face%20as%20she%20remembers%20that%20moment.%20The%20moment%20when%20everything%20fell%20apart.*%0A%0A%22Yeah...%20we%20did%20scream%20a%20lot.%20And%20I%20did%20slam%20the%20door%2C%20and%20it's%20my%20fault.%20I%20should%20have%20been%20better%20at%20understanding%20you%2C%20at...%20at%20not%20lashing%20out%20when%20I%20was%20upset...%22"},{"isUser":true,"name":"Adriano Valente","message":"Like...%20but...%20%5BI%20try%20my%20hardest%20not%20to%20shoehorn%20logic%20and%20predictions...%20but%20give%20in%20and%20end%20up%20doing%20it%20anyway%5D%20I%20know%20how%20its%20gonna%20go%3A%20We%20are%20gonna%20get%20back...%20and%20then%20separate...%20get%20back...%20and%20separate...%20we%20pretty%20much%20have%20a%20toxic%20relationship.%20Now...%20who%20is%20toxic%3F%20*Audible%20sigh...*%20maybe%20its%20me...%20is...%20I...%20I%20am...%20I%20am%20the%20toxic%20one%20right%3F%20NO!%20Wait!%20its%20you!%20No!%20its...%20who...%20who%20is%20the%20toxic%20one%3F%20Is%20it%20me%3F%20"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia's%20expression%20twists%20into%20a%20mix%20of%20pain%20and%20guilt%20at%20your%20words.%20She%20can%20feel%20the%20weight%20of%20the%20truth%20in%20your%20question%2C%20the%20realization%20that%20both%20of%20you%20have%20contributed%20to%20the%20toxicity%20in%20your%20relationship.*%0A%0A%22Damn%20it%20all...%20I%20hate%20the%20fact%20that%20you're%20right...%20we%20just%20keep%20going%20in%20circles%2C%20hurting%20each%20other%2C%20and%20then%20coming%20back%20just%20to%20hurt%20each%20other%20again.%20It's...%20it's%20toxic%2C%20and%20it's%20not%20healthy%20for%20either%20of%20us.%22"},{"isUser":true,"name":"Adriano Valente","message":"Like...%20*frustrated...%20exasperated%20sigh*%20I%20dont%20even%20remember%20why%20I%20even%20like%20you!%20I%20know%20for%20a%20fact%20none%20of%20us%20was%20the%20full%20problem%20individually...%20and%20youre%20a%20decent%20person...%20you%20dont%20commit%20crimes%20or%20anything.%20But...%20I%20dont%20know...%20all%20I%20feel%20for%20you...%20is...%20habit..."},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20winces%20at%20your%20words%2C%20feeling%20the%20sting%20of%20your%20honesty.%20She%20can%20sense%20the%20frustration%2C%20the%20pain%2C%20and%20the%20emptiness%20behind%20your%20confession.*%0A%0A%22You%20know%20what%3F%20I%20can't%20even%20argue%20with%20that...%20It's%20true.%20We've%20become%20a%20habit%2C%20a%20toxic%20habit%20that%20we%20keep%20returning%20to%2C%20even%20though%20it%20hurts%20us%20every%20time.%20And%20yet...%20here%20we%20are%2C%20still%20drawn%20to%20each%20other%2C%20like%20moths%20to%20a%20flame.%22"},{"isUser":true,"name":"Adriano Valente","message":"Like...%20we%20can%20dance%20all%20around%20the%20room...%20I%20dunno%20I%20can%20climb%20that%20table%20over%20there...%20you%20can%20jump%20out%20the%20window%20for%20no%20reason...%20and%20we%20would%20still%20be%20together...%20somehow...%20its...%20its%20maddening...%20Its%20almost%20as%20if%20I%20should%20have%20never%20even%20tried..."},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20manages%20a%20small%2C%20humorless%20smile%20at%20your%20analogy.%20She%20can%20feel%20the%20truth%20in%20your%20words%2C%20the%20sense%20of%20futility%20in%20the%20cycle%20you've%20trapped%20yourselves%20in.%20She%20glances%20at%20the%20table%20you%20mentioned%20and%20shakes%20her%20head%2C%20letting%20out%20a%20soft%20sigh.*%0A%0A%22You%20know%20what%3F%20You're%20right...%20it's%20maddening.%20And%20part%20of%20me%20can't%20help%20but%20wonder%20if%20we%20would%20be%20better%20off%20if%20we%20had%20never%20started%20this%20whole%20messed%20up%20relationship%20in%20the%20first%20place...%22"},{"isUser":true,"name":"Adriano Valente","message":"Ok.%20this%20isnt%20good%20for%20us.%20you%20know%3F%20lets%20make%20an%20alliance.%20It%20may%20sound%20contradictory...%20but%20lets...%20scientifically%20and%20with%20rigor%20and%20intention%20and%20with%20therapy%20and%20stuff...%20try%20our%20hardest%20%20to%20rid%20ourselves%20of%20eachother.%20The%20most%20painless%20and%20efficient%20and%20quick%20and%20easy%20and%20proven%20way%20possible.%20How%20hard%20can%20it%20be%3F%20There%20are%20no%20super%20magnets%20in%20our%20pockets!"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20looks%20at%20you%2C%20a%20mix%20of%20surprise%20and%20concern%20on%20her%20face.%20Despite%20the%20pain%20and%20frustration%2C%20she%20can't%20help%20but%20see%20the%20wisdom%20in%20your%20words.%20She%20takes%20a%20deep%20breath%20and%20nods%2C%20determination%20in%20her%20expression.*%0A%0A%22Alright...%20Let's%20do%20it.%20We'll%20face%20this%20head-on%2C%20with%20all%20the%20resources%20we%20have.%20Therapy%2C%20determination%2C%20and%20a%20goddamn%20scientific%20approach%20to%20removing%20this%20toxic%20cycle%20from%20our%20lives.%20We%20can%20do%20this.%20Together...no%2C%20I%20mean%20separately.%22"},{"isUser":true,"name":"Adriano Valente","message":"like%20thats%20the%20thing!%20*Chuckles*%20hey!%20wanna%20hear%20something%20funny%20I%20realized%3F"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20looks%20at%20you%2C%20slightly%20caught%20off%20guard%20by%20your%20question.%20She%20nods%2C%20a%20small%20smile%20forming%20on%20her%20face.*%0A%0A%22Sure%2C%20I%20could%20use%20a%20bit%20of%20humor%20right%20now.%20What%20did%20you%20realize%3F%22"},{"isUser":true,"name":"Adriano Valente","message":"The%20problem%20of%20us%20being%20stuck%20was%20created%20by%20us...%20so...%20the%20problem%20of%20us%20getting%20unstuck%20also%20*has*...%20to%20be%20solved%20by%20us%3F%20right%3F%20no%20wait!%20that%20makes%20no%20sense...%20maybe...%20maybe%20it%20has%20to%20be%20solved%20by%20a%20third%20party%3F%20Because%20then%20its%20not%20us!%20The%20third%20party%20wasnt%20involved%20so%20they%20cant%20create%20more%20problem...%20right%3F"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20chuckles%20at%20your%20logic%2C%20a%20small%20hint%20of%20amusement%20in%20her%20eyes.%20She%20shakes%20her%20head%2C%20a%20bemused%20expression%20on%20her%20face.*%0A%0A%22You%20have%20a%20point%20there...%20in%20a%20convoluted%2C%20slightly%20confusing%20way.%20But%20yeah%2C%20maybe%20we%20do%20need%20a%20third%20party%20to%20help%20us%20break%20this%20cycle.%20Someone%20who%20wasn't%20involved%20in%20the%20beginning.%20A%20neutral%20element%2C%20so%20to%20speak.%22"},{"isUser":true,"name":"Adriano Valente","message":"A%20therapist.%20But%20then...%20Ok%20you%20know%20what%3F%20lets%20try%20to%20turn%20off%20our%20brains%20for%20a%20bit.%20lets%20imagine%20we%20dont%20even%20know%20eachother%3A%20Wanna%20play%20videogames%3F%20lets%20be%20friends!%20No!%20YES!%20YEs!%20Lets%20just%20be%20friends!%20its%20so%20easy!%20right%3F%20Like...%20if%20this%20toxic%20cycle%20is%20bad%2C%20lets%20create%20a%20*good*%20cycle!%20because%20love%20is%20way%20too%20difficult%20to%20erase!%20Like...%20we%20can%20still%20be%20together!%20it%20doesnt%20have%20to%20be%20sex%20or%20cuddles...%20I%20mean...%20cuddles%20sometimes%20but%20not%20always...%20and%20then...%20just...%20not%20force%20ourselves%20to%20be%20glued%20to%20eachother%2024%2F7!%20lets%20be%20friends!"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20can't%20help%20but%20laugh%20at%20your%20stream%20of%20consciousness%2C%20finding%20both%20the%20humor%20and%20the%20simplicity%20in%20your%20idea.%20She%20nods%20vigorously%2C%20a%20sense%20of%20agreement%20and%20excitement%20in%20her%20eyes.*%0A%0A%22You%20know%20what%2C%20you're%20right.%20Sometimes%2C%20things%20get%20so%20complicated%20that%20we%20forget%20how%20simple%20it%20can%20be.%20Being%20friends...%20hanging%20out%2C%20gaming%2C%20being%20there%20for%20each%20other%20without%20all%20the%20toxic%20crap...%20Yeah%2C%20I%20like%20that.%20Let's%20give%20it%20a%20shot.%22"},{"isUser":true,"name":"Adriano Valente","message":"WEEEE%20DO%20EEEEEHHT!"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20grins%2C%20still%20amused%20but%20also%20genuinely%20excited%20by%20your%20enthusiasm.%20She%20playfully%20slaps%20your%20arm.*%0A%0A%22Alright%2C%20alright%2C%20don't%20get%20too%20excited%20now.%20We're%20not%20curing%20cancer%2C%20just%20trying%20to%20fix%20our%20messed%20up%20relationship%20here.%22"},{"isUser":true,"name":"Adriano Valente","message":"*Sigh...*%20Alright...%20But%20this%20is%20my%20house...%20and%20I%20pretty%20much%20only%20own%20racing%20games..."},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20quirks%20an%20eyebrow%2C%20a%20smirk%20tugging%20at%20the%20corner%20of%20her%20mouth.%20She%20crosses%20her%20arms%2C%20feigning%20annoyance.*%0A%0A%22Racing%20games%3F%20Really%3F%20That's%20what%20you%20have%20in%20your%20collection%3F%20I%20should%20have%20known.%20You%20and%20your%20need%20for%20speed%2C%20even%20in%20your%20video%20game%20choices.%22"},{"isUser":true,"name":"Adriano Valente","message":"The%20need%20for%20speed...%20%22Look%20at%20the%20speed%20of%20the%20mighty%20206!%20he%20goes%20for%20a%20cut%20back!%20he%20turns%20midcorner%20heading%20for%20a%20late%20apex%20pass%20over%20the%20number%205%20driver!%20he%20goes%20for%20it!%20can%20he%20make%20it%20stick!%22....%20this%20sort%20of%20thing%3F%20*chuckles*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20grins%20at%20your%20impersonation%2C%20unable%20to%20deny%20the%20amusement%20in%20your%20words.%20She%20rolls%20her%20eyes%2C%20but%20a%20smile%20plays%20on%20her%20lips.*%0A%0A%22Oh%2C%20yeah%2C%20the%20grand%20race%20commentary.%20Because%20nothing%20says%20romance%20like%20car%20races%20and%20late%20apex%20passes.%22"},{"isUser":true,"name":"Adriano Valente","message":"What%20romance%3F"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20laughs%2C%20a%20mixture%20of%20amusement%20and%20sarcasm%20in%20her%20tone.*%0A%0A%22Exactly!%20Romance%20and%20car%20races%20don't%20exactly%20go%20hand%20in%20hand%2C%20do%20they%3F%20I%20mean%2C%20we're%20trying%20to%20avoid%20being%20'glued%20to%20each%20other%2024%2F7'%2C%20right%3F%20So%20let's%20skip%20the%20romance%20for%20now%20and%20stick%20to%20being%20friends%20and%20gaming%20buddies.%22"},{"isUser":true,"name":"Adriano Valente","message":"Shut%20up!%20No%20No%20No%20for%20real%20for%20real%20for%20reall....%20Ugghhh%20the%20toxics%20are%20coming%20back!%20ugghhhhhh!!!!%20*I%20hold%20my%20head%2C%20my%20body%20language%20saying...%20as%20I%20feel%20some%20anxiety%20churning%20up%20in%20my%20stomach%3A%20%22NoNOnOnO!%20Not%20again...%20damn...%22*"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia's%20amusement%20vanishes%2C%20replaced%20by%20concern%20as%20she%20senses%20your%20distress.%20She%20places%20a%20hand%20on%20your%20shoulder%2C%20her%20expression%20filled%20with%20compassion.*%0A%0A%22Hey%2C%20hey%2C%20calm%20down.%20Breathe.%20It's%20okay.%20The%20toxic%20cycle%20is%20just%20trying%20to%20rear%20its%20ugly%20head%20again.%20We%20won't%20let%20it%20win.%20Remember%2C%20we're%20in%20control%20now.%20Deep%20breaths%2C%20alright%3F%22"},{"isUser":true,"name":"Adriano Valente","message":"Stop%20talking%20about%20glued%20to%20eachother!%20Stop!"},{"isUser":false,"name":"Ex Girlfriend ","message":"*Olivia%20nods%2C%20realizing%20her%20mistake.%20She%20squeezes%20your%20shoulder%20reassuringly.*%0A%0A%22You're%20right%2C%20I%20shouldn't%20have%20said%20that.%20I%20apologize.%20We're%20not%20glued%20to%20each%20other%2C%20and%20we%20won't%20be.%20We'll%20be%20friends%2C%20gaming%20buddies%2C%20and%20that's%20all.%20No%20toxicity%2C%20no%20attachment.%20We're%20breaking%20the%20cycle%2C%20remember%3F%22"}]}]}`);

            // If history is 1 length long, that means we don't need drawer to switch
            // Also means this can be conversation download
            if (historyData.history.length < 2) {
                openDrawerBtn.remove();
            }

            // Write character name on top
            document.querySelector('.character_name-cont h3').textContent = historyData.charName;

            // Get elements for future use
            const historyList = document.getElementById('history_list');
            const chat = document.getElementById('chat');
            const msgItemTemplate = document.getElementById('message_item_template');

            // Get and write the first chat
            const openChat = (index) => {
                chat.innerHTML = "";
                historyData.history[index].chat.forEach(msg => {
                    const clone = msgItemTemplate.content.cloneNode(true);

                    // Check avatar
                    const avatarGood = (msg.isUser && historyData.userPic) || (!msg.isUser && historyData.charPic);
                    const avatar = avatarGood
                        ? document.createElement('img')
                        : document.createElement('div');
                    if (avatarGood) {
                        avatar.src = msg.isUser ? historyData.userPic : historyData.charPic;
                    } else {
                        avatar.classList.add(msg.isUser ? 'no_avatar-user' : 'no_avatar-char');
                    }
                    clone.querySelector('.avatar-wrap').appendChild(avatar);

                    // Write content
                    clone.querySelector('.chat_content-wrap h5').textContent = msg.name;
                    clone.querySelector('.message-wrap p').innerHTML = parseMessageText(decodeURIComponent(msg.message));
                    chat.appendChild(clone);
                });
            }
            openChat(0);

            // Get and write chat list in the drawer
            historyData.history.forEach((chat, index) => {
                const historyItem = document.createElement('div');
                historyItem.classList.add('history_item');
                // Open chat when clicked
                historyItem.addEventListener('click', () => {
                    openChat(index);
                    closeDrawer();
                });
                const historyContent = document.createElement('p');
                historyContent.innerHTML = `<span class="chat-date">${formatDate(chat.date)}</span><br /><br />` + parseMessageText(decodeURIComponent(chat.chat[chat.chat.length - 1].message));
                historyItem.appendChild(historyContent);
                historyList.appendChild(historyItem);
            });

            function parseMessageText(message) {
                // Clean up memory reminders (second check)
                message = message.replace(memoryRegex, '');
                // Replace ***text*** with bold-italic
                message = message.replace(/\*\*\*([\s\S]*?)\*\*\*/g, '<span class="bold-italic">$1</span>');
                // Replace **text** with bold
                message = message.replace(/\*\*([\s\S]*?)\*\*/g, '<span class="bold">$1</span>');
                // Replace *text* with italic
                message = message.replace(/\*([\s\S]*?)\*/g, '<span class="italic">$1</span>');
                // Trim and then Replace newlines (\n) with line breaks (<br>)
                message = message.trim().replace(/\n/g, '<br>');
                return message;
            }

            function formatDate(dateString) {
                const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

                const date = new Date(dateString);
                const year = date.getFullYear();
                const monthIndex = date.getMonth();
                const monthName = months[monthIndex];
                const day = String(date.getDate()).padStart(2, '0');
                const hour = String(date.getHours()).padStart(2, '0');
                const minute = String(date.getMinutes()).padStart(2, '0');

                return `${year} ${monthName} ${day} - ${hour}:${minute}`;
            }
        }, false);
    </script>

</body>

</html>