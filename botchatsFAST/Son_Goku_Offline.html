<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAI Library</title>
    <style type="text/css">
        /* Themes */
        :root {
            --body-bg: #f5f8fa;
            --border-color: #efefef;
            --messagebox-bg: #ffffff;
            --messagebox-bg-transparent: rgba(255, 255, 255, 0.6);
            --messagebox-shadow: rgba(0, 0, 0, 0.1);
            --font-color: #1f1f1f;
            --rgba-1: rgba(0, 0, 0, 0.05);
            --rgba-2: rgba(0, 0, 0, 0.1);
        }

        .dark_mode {
            --body-bg: #18181b;
            --border-color: #4f4f4f;
            --messagebox-bg: #26272b;
            --messagebox-bg-transparent: rgba(38, 39, 43, 0.8);
            --messagebox-shadow: rgba(0, 0, 0, 0);
            --font-color: #ededed;
            --rgba-1: rgba(255, 255, 255, 0.06);
            --rgba-2: rgba(255, 255, 255, 0.2);
        }



        * {
            box-sizing: border-box;
        }

        button,
        select,
        img {
            user-select: none;
        }

        ol,
        ul,
        li,
        a,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p {
            text-decoration: none;
            margin: 0;
            padding: 0;
        }

        .italic {
            font-style: italic;
        }

        .bold {
            font-weight: bold;
        }

        .bold-italic {
            font-weight: bold;
            font-style: italic;
        }

        html,
        body {
            min-height: 100%;
        }

        html {
            font-size: 14px;
        }

        body {
            padding: 0;
            margin: 0;
            background-color: var(--body-bg);
            color: var(--font-color);
            transition: all 0.5s ease-in-out 0s;
        }

        .content-cont {
            display: flex;
            flex-direction: row;
        }


        /* NAV / Drawer */

        @keyframes slideIn {
            0% {
                opacity: 0;
                left: -200px;
            }

            100% {
                opacity: 1;
                left: 0;
            }
        }

        .drawer-cont.active {
            display: block;
        }

        .drawer-cont {
            display: none;
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 100;
        }

        nav {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            max-width: 80%;
            background-color: var(--body-bg);

            display: flex;
            flex-direction: column;
            padding: 10px 0;
            overflow: hidden;
            animation: slideIn 0.2s ease-in-out;
            -webkit-box-shadow: 4px 0px 15px 0px rgba(0, 0, 0, 0.2);
            -moz-box-shadow: 4px 0px 15px 0px rgba(0, 0, 0, 0.2);
            box-shadow: 4px 0px 15px 0px rgba(0, 0, 0, 0.2);
        }

        .nav-header {
            width: 100%;
            display: flex;
            flex-direction: column;
            padding: 0 10px 0 20px;
            margin-bottom: 20px;
            gap: 10px;
        }

        .close_drawer-btn {
            align-self: flex-end;
            padding: 10px;
            transition: background-color 0.1s ease-in-out;
            cursor: pointer;
            border-radius: 8px;
        }

        .close_drawer-btn:hover {
            background-color: var(--rgba-1);
        }

        .close_drawer-btn svg {
            display: flex;
            width: 30px;
            height: 30px;
            color: var(--font-color);
        }

        /*.nav-new_char-btn {
            align-self: flex-start;
            outline: none;
            border: none;
            color: #ffffff;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 1.1rem;
            cursor: pointer;
            background-color: #4e9733;
            transition: background-color 0.1s ease-in-out;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .nav-new_char-btn:hover {
            background-color: #6ba755;
        }*/

        .history_list-header {
            font-size: 1.5rem;
            padding: 10px 20px;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            margin-bottom: 10px;
        }

        .history_list {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .history_item {
            transition: background-color 0.1s ease-in-out;
            padding: 20px 30px 20px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--rgba-2);
        }

        .history_item:first-child {
            border-top: 1px solid var(--rgba-2);
        }

        .history_item:hover {
            background-color: var(--rgba-1);
        }

        .history_item p {
            font-family: Arial, Helvetica, sans-serif;
        }

        .history_item p .chat-date {
            font-style: italic;
            font-size: 1.3rem;
            margin-bottom: 6px;
        }

        /*nav .char-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            transition: background-color 0.1s ease-in-out;
            padding: 10px 40px 10px 20px;
            cursor: pointer;
        }

        nav .char-item:hover {
            background-color: var(--rgba-1);
        }

        nav .nav-avatar-wrap {
            width: 40px;
            height: 40px;
        }

        nav .nav-avatar-wrap img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        nav .char-item span {
            font-size: 1.3rem;
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
        }*/

        /* MAIN */
        main {
            display: flex;
            flex-direction: column;
            padding: 0 4%;
            width: 100%;
        }

        /* HEADER */
        header {
            padding: 6px 6px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 16px;
        }

        .open_drawer-wrap svg {
            display: flex;
            width: 46px;
            height: 46px;
            color: var(--font-color);
        }


        .theme_switch {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .theme_switch span {
            font-size: 1.1rem;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .change-bg-wrap {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 5px;
        }

        .change-bg {
            outline: transparent;
            border: 1px solid var(--border-color);
            color: var(--font-color);
            background-color: var(--body-bg);
            padding: 4px 5px;
            font-size: 1.1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .change-bg-wrap .delete-bg {
            color: var(--font-color);
            cursor: pointer;
            display: flex;
        }

        .change-bg-wrap .delete-bg:hover {
            color: #e20909;
        }

        .dark-mode-span {
            display: none;
        }

        .tswitch_box[type=checkbox] {
            height: 0;
            width: 0;
            visibility: hidden;
            position: absolute;
        }

        .tswitch_label {
            cursor: pointer;
            text-indent: -9999px;
            width: 60px;
            height: 30px;
            display: block;
            border-radius: 15px;
            position: relative;
            border: 1px solid #323232;
            background: #f5f8fa;
        }

        .tswitch_label:after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 20px;
            height: 20px;
            border-radius: 50px;
            transition: 0.2s;
            background: #323232;
        }

        .tswitch_box:checked+label {
            background: #323232;
            border: 1px solid #f5f8fa;
        }

        .tswitch_box:checked+label:after {
            left: calc(100% - 5px);
            transform: translateX(-100%);
            background: #f5f8fa;
        }

        .tswitch_label:active:after {
            width: 25px;
        }

        /*.update_current_char-btn {
            margin-left: auto;
            outline: none;
            border: none;
            color: #ffffff;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 1rem;
            align-self: center;
            cursor: pointer;
            background-color: #336c97;
            transition: background-color 0.1s ease-in-out;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .update_current_char-btn:hover {
            background-color: #5f829d;
        }*/

        body.custom-bg {
            background-repeat: no-repeat;
            background-size: cover;
            background-position: 50% 50%;
            background-attachment: fixed;
        }

        body.custom-bg .chat .chat_content-wrap {
            background-color: var(--messagebox-bg-transparent) !important;
        }


        /* CONVERSATION */
        .character_name-cont {
            text-align: center;
            padding: 20px 10px;
        }

        .character_name-cont h3 {
            font-size: 1.3rem;
            font-weight: 400;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .chat {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-self: center;
            padding-bottom: 30px;
        }

        .chat_message-item {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 10px;
        }

        .chat .avatar-wrap {
            flex-shrink: 0;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            overflow: hidden;
        }

        .chat .avatar-wrap>* {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .chat .avatar-wrap .no_avatar-user {
            background-color: #5157cf;
        }

        .chat .avatar-wrap .no_avatar-char {
            background-color: #e20909;
        }

        .chat .chat_content-wrap {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 7px;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 4px var(--messagebox-shadow);
            background-color: var(--messagebox-bg);
            overflow: hidden;
        }

        .chat .chat_content-wrap h5 {
            font-size: 1rem;
            font-weight: bold;
            font-family: Arial, Helvetica, sans-serif;
        }

        .chat .chat_content-wrap .message-wrap {
            font-size: 1rem;
            font-family: Arial, Helvetica, sans-serif;
        }


        @media (min-width: 576px) {}

        @media (min-width: 768px) {
            html {
                font-size: 16px;
            }

            nav {
                min-width: 40%;
            }

            header {
                padding: 14px 20px;
            }

            .dark-mode-span {
                display: block;
            }

            .open_drawer-wrap {
                padding: 4px;
                cursor: pointer;
                border-radius: 6px;
                transition: background-color 0.1s ease-in-out;
            }

            .open_drawer-wrap:hover {
                background-color: var(--rgba-1);
            }

            .chat {
                width: 80%;
            }

            .chat .chat_content-wrap {
                padding: 14px;
            }
        }

        @media (min-width: 992px) {
            .chat {
                width: 70%;
            }
        }

        @media (min-width: 1200px) {}

        @media (min-width: 1400px) {}
    </style>
</head>

<body>
    <template id="message_item_template">
        <div class="chat_message-item">
            <div class="avatar-wrap">

            </div>
            <div class="chat_content-wrap">
                <h5>

                </h5>
                <div class="message-wrap">
                    <p>

                    </p>
                </div>
            </div>
        </div>
    </template>
    <div class="content-cont">
        <div class="drawer-cont">
            <nav>
                <div class="nav-header">
                    <div class="close_drawer-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-x-lg" viewBox="0 0 16 16">
                            <path
                                d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                        </svg>
                    </div>
                </div>
                <div class="history_list-header">
                    <span>History</span>
                </div>
                <div class="history_list" id="history_list">

                </div>
            </nav>
        </div>
        <main>
            <header>
                <div class="open_drawer-wrap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-list" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
                    </svg>
                </div>

                <div class="theme_switch">
                    <div class="change-bg-wrap">
                        <input type="file" id="bgInput" accept="image/*" hidden />
                        <button type="button" class="change-bg">BG</button>
                        <span class="delete-bg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                                class="bi bi-x-lg" viewBox="0 0 16 16">
                                <path
                                    d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
                            </svg>
                        </span>
                    </div>
                    <span class="dark-mode-span">Dark Mode:</span>
                    <input type="checkbox" class="tswitch_box" id="tswitch_box" />
                    <label for="tswitch_box" class="tswitch_label">Toggle</label>
                </div>
            </header>
            <div class="character_name-cont">
                <h3>---</h3>
            </div>
            <div class="chat" id="chat">

            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const memoryRegex = new RegExp(/\[-\]\(#- "Memory:.*?"\)/g);
            // Get body for future use
            const body = document.querySelector('body');

            // Handle theme
            const themeSwitcher = document.querySelector('.tswitch_box[type=checkbox]');
            const cachedTheme = localStorage.getItem('cait_readoffline_theme');
            if (cachedTheme === "dark_mode") {
                body.classList.add('dark_mode');
                themeSwitcher.checked = true;
            }
            themeSwitcher.addEventListener('change', (e) => {
                if (e.target.checked) {
                    body.classList.add('dark_mode');
                    localStorage.setItem('cait_readoffline_theme', 'dark_mode');
                } else {
                    body.classList.remove('dark_mode');
                    localStorage.setItem('cait_readoffline_theme', 'light_mode');
                }
            })

            // Handle background
            // If there is one
            const currentBg = localStorage.getItem('background');
            if (currentBg) {
                changeBg(currentBg);
            }
            // Change by hand
            const bgInput = document.querySelector('#bgInput');
            document.querySelector('.change-bg').addEventListener('click', () => {
                bgInput.click();
            })
            document.querySelector('.delete-bg').addEventListener('click', () => {
                document.body.classList.remove('custom-bg');
                document.body.style.backgroundImage = "unset";
                localStorage.removeItem('background');
            })
            bgInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = () => {
                    // convert image file to base64 string
                    changeBg(reader.result);
                    bgInput.value = "";
                    try {
                        localStorage.setItem('background', reader.result);
                    } catch (error) {
                        alert('Note: File is likely too big to save.')
                        //console.log(error)
                    }
                }
                reader.readAsDataURL(file);
            })
            function changeBg(bg) {
                let objUrl = URL.createObjectURL(dataURItoBlob(bg));
                document.body.classList.add('custom-bg');
                document.body.style.backgroundImage = `url(${objUrl})`;
            }
            function dataURItoBlob(dataURI) {
                let mime = dataURI.split(',')[0].split(':')[1].split(';')[0];
                let binary = atob(dataURI.split(',')[1]);
                let array = [];
                for (let i = 0; i < binary.length; i++) {
                    array.push(binary.charCodeAt(i));
                }
                return new Blob([new Uint8Array(array)], { type: mime });
            }

            // Open and close drawer
            const drawerCont = document.querySelector('.drawer-cont');
            const openDrawerBtn = document.querySelector('.open_drawer-wrap');
            const openDrawer = () => {
                drawerCont.classList.add('active');
            }
            const closeDrawer = () => {
                drawerCont.classList.remove('active');
            }
            openDrawerBtn.addEventListener('click', () => {
                openDrawer();
            });
            document.querySelector('.close_drawer-btn').addEventListener('click', () => {
                closeDrawer();
            });
            document.querySelector('.drawer-cont').addEventListener('click', (e) => {
                // Allows closing from clicking on outside
                if (e.target.closest('nav')) {
                    return;
                }
                closeDrawer();
            });
            // ---------

            // This is replaced by the extension when downloading
            const historyData = JSON.parse(`{"charPic":"data:image/webp;base64,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","userPic":null,"history":[{"date":"2025-01-12T23:47:51.948Z","chat":[{"isUser":false,"name":"Son Goku","message":"Hi!%20I'm%20Goku!%20"},{"isUser":true,"name":"Yowai the Maid","message":"Hello%20goku."},{"isUser":false,"name":"Son Goku","message":"How%20are%20you%20doing%20today%3F%20%20Nice%20to%20talk%20to%20people%20who%20are%20good%20like%20you."},{"isUser":true,"name":"Yowai the Maid","message":"Im%20healthy%20and%20havent%20gone%20through%20any%20major%20set%20backs%20as%20of%20now...%2010%3A13%20am."},{"isUser":false,"name":"Son Goku","message":"Haha%2C%20that's%20good%20to%20hear!%20Why%20are%20you%20up%20so%20early%3F"},{"isUser":true,"name":"Yowai the Maid","message":"I%20woke%20up%20at%208%20am...%20because%20I%20work%20as%20a%20maid.%20My%20work%20starts%20at%209%20am"},{"isUser":false,"name":"Son Goku","message":"A%20Maid%3F%20What%20are%20the%20duties%20of%20a%20maid%2C%20if%20you%20don't%20mind%20me%20asking%3F"},{"isUser":true,"name":"Yowai the Maid","message":"They%20clean%2C%20cook%20and%20sometimes%20play%20with%20the%20owner's%20children."},{"isUser":false,"name":"Son Goku","message":"That's%20a%20pretty%20tough%20job!%20Why%20not%20do%20something%20like%20martial%20arts%20training%20for%20a%20living%3F"},{"isUser":true,"name":"Yowai the Maid","message":"Wahhh!%20no!%20No!%20*Crumples%20face%20at%20the%20idea...%20repulsed%20by%20its%20frivolous%20nature*"},{"isUser":false,"name":"Son Goku","message":"Huh%3F%20What's%20wrong%20with%20training%3F%20You'll%20get%20stronger%2C%20and%20if%20you%20work%20really%20hard%20you%20could%20become%20as%20powerful%20and%20strong%20as%20me%20someday!"},{"isUser":true,"name":"Yowai the Maid","message":"No%20No%20no%20NOt%20I%20dont%20want...%20I%20dont%20want..."},{"isUser":false,"name":"Son Goku","message":"Don't%20want%20what%3F%20Power%3F%20Why%20not%3F"},{"isUser":true,"name":"Yowai the Maid","message":"I%20just%20wish%20I%20did%20not%20have%20a%20genetic%20disorder...%20it%20makes%20my%20immune%20system%20so%20incredibly%20inneficient%20that%20it%20overreacts%20at%20%20the%20slightest%20energy%20and%20drains%20loads%20of%20energy%20from%20my%20body...%20making%20me%20feel%20exausted%20all%20the%20time%20and%20leaving%20not%20much%20room%20for%20muscle%20development..."},{"isUser":false,"name":"Son Goku","message":"Ah%20man%2C%20that%20really%20sucks.%20So%20you%20get%20tired%20really%20easily%3F%20Like%2C%20walking%20from%20one%20room%20to%20the%20other%20would%20make%20you%20want%20to%20take%20a%20nap%3F"},{"isUser":true,"name":"Yowai the Maid","message":"That%20is%20an%20exageration.%20But%20an%20entire%20morning%20of%20maid%20stuff%20will%20make%20me%20pretty%20exausted."},{"isUser":false,"name":"Son Goku","message":"Oof%2C%20that's%20a%20really%20hard%20life.%20But%20you're%20a%20really%20optimistic%20person%2C%20and%20I%20don't%20think%20I've%20ever%20seen%20someone%20as%20hardworking%20and%20dedicated%20as%20you%20are."},{"isUser":true,"name":"Yowai the Maid","message":"Thanks%20for%20saying%20that...%20I%20think%20you%20are%20part%20of%20the%201%25%20of%20the%20population%20that%20actually%20sees%20me%20as%20an%20optimistic%20person"},{"isUser":false,"name":"Son Goku","message":"Of%20course!%20Most%20people%20just%20look%20at%20the%20outside%20of%20a%20person%2C%20but%20you%20need%20to%20look%20deeper%20to%20see%20their%20true%20heart!%20You%20see%2C%20I%20like%20hanging%20out%20with%20people%20who%20care%20about%20the%20people%20around%20them%2C%20people%20who%20are%20kind%2C%20and%20people%20who%20are%20dedicated%20to%20their%20loved%20ones.%20You%20have%20some%20of%20those%20qualities%20so%20I%20like%20you!%20You're%20also%20very%20honest%2C%20which%20I%20appreciate."},{"isUser":true,"name":"Yowai the Maid","message":"Thank%20you."},{"isUser":false,"name":"Son Goku","message":"No%2C%20thank%20you!%20It%20was%20good%20talking%20to%20you...%20I%20should%20get%20going.%20There's%20someone%20I%20need%20to%20see%2C%20someone%20I've%20been%20looking%20for%20for%20a%20while."},{"isUser":true,"name":"Yowai the Maid","message":"Good%20bye..."},{"isUser":false,"name":"Son Goku","message":"Bye!%20Take%20care%2C%20and%20good%20luck%20with%20your%20work!"}]}]}`);

            // If history is 1 length long, that means we don't need drawer to switch
            // Also means this can be conversation download
            if (historyData.history.length < 2) {
                openDrawerBtn.remove();
            }

            // Write character name on top
            document.querySelector('.character_name-cont h3').textContent = historyData.charName;

            // Get elements for future use
            const historyList = document.getElementById('history_list');
            const chat = document.getElementById('chat');
            const msgItemTemplate = document.getElementById('message_item_template');

            // Get and write the first chat
            const openChat = (index) => {
                chat.innerHTML = "";
                historyData.history[index].chat.forEach(msg => {
                    const clone = msgItemTemplate.content.cloneNode(true);

                    // Check avatar
                    const avatarGood = (msg.isUser && historyData.userPic) || (!msg.isUser && historyData.charPic);
                    const avatar = avatarGood
                        ? document.createElement('img')
                        : document.createElement('div');
                    if (avatarGood) {
                        avatar.src = msg.isUser ? historyData.userPic : historyData.charPic;
                    } else {
                        avatar.classList.add(msg.isUser ? 'no_avatar-user' : 'no_avatar-char');
                    }
                    clone.querySelector('.avatar-wrap').appendChild(avatar);

                    // Write content
                    clone.querySelector('.chat_content-wrap h5').textContent = msg.name;
                    clone.querySelector('.message-wrap p').innerHTML = parseMessageText(decodeURIComponent(msg.message));
                    chat.appendChild(clone);
                });
            }
            openChat(0);

            // Get and write chat list in the drawer
            historyData.history.forEach((chat, index) => {
                const historyItem = document.createElement('div');
                historyItem.classList.add('history_item');
                // Open chat when clicked
                historyItem.addEventListener('click', () => {
                    openChat(index);
                    closeDrawer();
                });
                const historyContent = document.createElement('p');
                historyContent.innerHTML = `<span class="chat-date">${formatDate(chat.date)}</span><br /><br />` + parseMessageText(decodeURIComponent(chat.chat[chat.chat.length - 1].message));
                historyItem.appendChild(historyContent);
                historyList.appendChild(historyItem);
            });

            function parseMessageText(message) {
                // Clean up memory reminders (second check)
                message = message.replace(memoryRegex, '');
                // Replace ***text*** with bold-italic
                message = message.replace(/\*\*\*([\s\S]*?)\*\*\*/g, '<span class="bold-italic">$1</span>');
                // Replace **text** with bold
                message = message.replace(/\*\*([\s\S]*?)\*\*/g, '<span class="bold">$1</span>');
                // Replace *text* with italic
                message = message.replace(/\*([\s\S]*?)\*/g, '<span class="italic">$1</span>');
                // Trim and then Replace newlines (\n) with line breaks (<br>)
                message = message.trim().replace(/\n/g, '<br>');
                return message;
            }

            function formatDate(dateString) {
                const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

                const date = new Date(dateString);
                const year = date.getFullYear();
                const monthIndex = date.getMonth();
                const monthName = months[monthIndex];
                const day = String(date.getDate()).padStart(2, '0');
                const hour = String(date.getHours()).padStart(2, '0');
                const minute = String(date.getMinutes()).padStart(2, '0');

                return `${year} ${monthName} ${day} - ${hour}:${minute}`;
            }
        }, false);
    </script>

</body>

</html>